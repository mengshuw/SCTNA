
<!DOCTYPE html>
<html>

<head>
	<title>SCTNA | Live Chat</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">

	<!-- Logo -->
    <link rel="shortcut icon" type="image/png" href="/img/logo_sctna.png">
    
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/home.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
</head>

<style type="text/css">

	section {
		background-color: #EEEEEE;
	}

	#chat-container {
		width: 100%;
		height: 500px;
	}
		
	.chat {
		max-width: 100%;
	}

	.chat-name,
	.chat-messages,
	.chat-textarea {
		border: 1px solid #bbb;
	}

	.chat-name {
		width: 100%;
		padding: 10px;
		border-bottom: 0;
		margin: 0;
	}

	.chat-messages {
		width: 100%;
		height: 300px;
		overflow-y: scroll;
		padding: 10px;
	}

	.chat-message {
		margin-bottom: 20px;
	}

	.chat-textarea {
		width: 100%;
		height: 50px;
		padding: 10px;
		border-top: 0;
		margin: 0;
		max-width: 100%;
		max-height: 80px;
	}

	.chat-status {
		width: 100%;
		color: #bbb;
		border: none;
		margin-bottom: 10px;
	}

	.chat-name,
	.chat-textarea,
	.chat-status {
		outline: none;
	}

</style>

<body>

	<header>
        <div class="container">
            <img id="logo_usc" src="/img/logo_usc_full.jpg"/>
            <label class="title">
                <label class="title-gold">SC</label>
                <label><label class="title-red">T</label>ROJANS</label>
                <label><label class="title-red">N</label>EIGHBORHOOD</label>
                <label><label class="title-red">A</label>SSOCIATION</label>
            </label>
        </div>
    </header>

    <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
    	<div class="container">
    		<button id="menu" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
	            <i class="fa fa-bars"></i> MENU
	        </button>
	        <div class="collapse navbar-collapse" id="navbarNav">
	            <ul class="navbar-nav">
	                <li class="nav-item">
	                    <a class="nav-link text-center js-scroll-trigger" href="/">HOME</a>
	                </li>
	                <li class="nav-item">
	                    <a class="nav-link text-center" href="/about_us">ABOUT US</a>
	                </li>
	                <li class="nav-item">
	                    <a class="nav-link text-center" href="#">DONATE</a>
	                </li>
	                <li class="nav-item">
	                    <a class="nav-link text-center" href="/impact_area">IMPACT AREA</a>
	                </li>
	                <li class="nav-item">
	                    <a class="nav-link text-center" href="#">TOWN HALL</a>
	                </li>
	            </ul>
	        </div>
    	</div>
    </nav>

	<section>
        <div class="container">
            <div class="section-heading">Live Chat Area</div>
            <div class="resources">
                <div class="row align-items-center resource-item">
                    <div id="chat-container">
                    	
                    	<div class="chat"> 
							<input type="text" class="chat-name" placeholder="Enter Your Name">
							<div class="chat-messages" id="messages-area">
							</div>
							<textarea class="chat-textarea" placeholder="Type Your Message"></textarea>
							<input type="text" class="chat-status" value="Status : Connecting...">
						</div>
						<input type="button" id="submitButton" value="Submit" onclick="submit()">
						<input type="button" id="clearButton" value="Clear" onclick="clear()">

                    </div>
                </div>
            </div>
            
        </div>
        
    </section>



	<footer>
        <div class="container footer-upper">
            <img src="/img/bookmark.png" id="bookmark"/>
            <div class="row">
                <div class="layout-half layout-half-padding">
                    <div class="footer-heading">
                        <i class="fas fa-caret-right"></i> About us
                    </div>
                    <div class="footer-content">
                        <p>The SC Trojans Neighborhood Association aims to protect and assist renters within the USC DPS area who have had their rights violated by landlords or property management companies.</p>
                        <a>Read more..</a>
                    </div>
                </div>
                <div class="layout-half layout-half-padding">
                    <div class="footer-heading">
                        <i class="fas fa-caret-right footer-heading-icon"></i>
                        <label class="footer-heading-font">Follow us</label>
                    </div>
                    <div class="footer-content">
                        <div>
                            <i class="fas fa-angle-right"></i>
                            <i class="fab fa-facebook-square"></i> facebook
                        </div>
                        <div>
                            <i class="fas fa-angle-right"></i>
                            <i class="fab fa-instagram"></i> instagram                                
                        </div>
                        <div>
                            <i class="fas fa-angle-right"></i>
                            <i class="fas fa-envelope-square"></i> email                                
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-lower">
            <p class="text-center">Copyright Â© 2018 USC SCTNA</p>
        </div>
    </footer>


	
	<!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="js/smoothscroll.js"></script>
	
    <!-- Socket IO JS -->
	<script src="/chat/socket.io/socket.io.js"></script>
	<script type="text/javascript">

		var connection = true;
		var messagesArea = document.getElementById('messages-area');

		// Change Status Display
		function setStatus(s) {
			$('.chat-status').val(s);
			if(connection) {
				var delay = setTimeout(function(  ) {
					setStatus("Status : Idle");
					clearInterval(delay);
				}, 3000);
			}
		}

		// Submit Message
		function submit() {
			if (!connection) {
				return;
			}
			var name = $('.chat-name').val();
			var text = $('.chat-textarea').val();
			socket.emit('input', {
				name: name,
				text: text
			});
		}

		// Connect to Socket
		try {
			var socket = io.connect('http://tna.usc.edu', {path : '/chat/socket.io'});
		} catch(e) {
			connection = false;
			setStatus("Status : Unable To Connect Database");
		}

		if (socket !== undefined) {

			setStatus("Status : Connected To Database");

			// Get Output Result From Node
			socket.emit('getAllMessages', {});

			// Get Output Result From Node
			socket.on('output', function(data) {
				if (data.length) {
					var container = $(".chat-messages");
					for (var i = 0; i < data.length; i++) {
						var message = document.createElement('div');
						message.setAttribute('class', 'chat-message');
						message.textContent = data[i].name + ": " + data[i].text;
						container.append(message);
						messagesArea.scrollTop = messagesArea.scrollHeight;
					}
				}
			});

			// Get Status From Node
			socket.on('status', function(data) {
				setStatus((typeof data === 'object') ? data.message : data);
				if (data.clear == true) {
					$('.chat-textarea').val("");
				}
			});
		}

	</script>

</body>

</html>